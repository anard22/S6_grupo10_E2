 Tabla de Roles de usuario
CREATE TABLE ROLES (
    ROL_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOMBRE VARCHAR2(50) NOT NULL UNIQUE,
    DESCRIPCION VARCHAR2(200)
);

-- Tabla de Usuarios (bibliotecarios y lectores)
CREATE TABLE USUARIOS (
    USUARIO_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    RUT VARCHAR2(15) NOT NULL UNIQUE,
    NOMBRE VARCHAR2(100) NOT NULL,
    EMAIL VARCHAR2(100) UNIQUE,
    CONTRASENA VARCHAR2(100) NOT NULL,
    ROL_ID NUMBER NOT NULL,
    FECHA_REGISTRO DATE DEFAULT SYSDATE,
    CONSTRAINT FK_USUARIO_ROL FOREIGN KEY (ROL_ID) REFERENCES ROLES(ROL_ID)
);

-- Tabla de Libros
CREATE TABLE LIBROS (
    LIBRO_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TITULO VARCHAR2(200) NOT NULL,
    AUTOR VARCHAR2(150),
    GENERO VARCHAR2(100),
    UBICACION VARCHAR2(100),
    CAPACIDAD_MAXIMA NUMBER, -- si aplica, o puede eliminarse
    PRECIO_POR_NOCHE NUMBER(10,2), -- si aplica, o puede eliminarse
    ESTADO VARCHAR2(20) DEFAULT 'DISPONIBLE', -- DISPONIBLE, PRESTADO, RESERVADO, etc.
    FECHA_REGISTRO DATE DEFAULT SYSDATE
);

-- Tabla de Lectores (opcional si se quiere separar de usuarios)
-- En este diseño, lectores son usuarios con rol específico, por lo que no es necesaria tabla aparte.

-- Tabla de Préstamos
CREATE TABLE PRESTAMOS (
    PRESTAMO_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USUARIO_ID NUMBER NOT NULL,
    LIBRO_ID NUMBER NOT NULL,
    FECHA_PRESTAMO DATE NOT NULL,
    FECHA_DEVOLUCION DATE,
    ESTADO VARCHAR2(20) DEFAULT 'ACTIVO', -- ACTIVO, DEVUELTO, ATRASADO
    CONSTRAINT FK_PRESTAMO_USUARIO FOREIGN KEY (USUARIO_ID) REFERENCES USUARIOS(USUARIO_ID),
    CONSTRAINT FK_PRESTAMO_LIBRO FOREIGN KEY (LIBRO_ID) REFERENCES LIBROS(LIBRO_ID)
);

-- Tabla para historial de cambios o auditoría (opcional)
CREATE TABLE AUDITORIA (
    AUDITORIA_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USUARIO_ID NUMBER,
    ACCION VARCHAR2(100),
    FECHA_ACCION DATE DEFAULT SYSDATE,
    DETALLE VARCHAR2(4000),
    CONSTRAINT FK_AUDITORIA_USUARIO FOREIGN KEY (USUARIO_ID) REFERENCES USUARIOS(USUARIO_ID)
);

-- Tabla para recomendaciones (si se integra con servicio externo)
CREATE TABLE RECOMENDACIONES (
    RECOMENDACION_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USUARIO_ID NUMBER NOT NULL,
    LIBRO_ID NUMBER NOT NULL,
    FECHA_RECOMENDACION DATE DEFAULT SYSDATE,
    CONSTRAINT FK_RECOMENDACION_USUARIO FOREIGN KEY (USUARIO_ID) REFERENCES USUARIOS(USUARIO_ID),
    CONSTRAINT FK_RECOMENDACION_LIBRO FOREIGN KEY (LIBRO_ID) REFERENCES LIBROS(LIBRO_ID)
);
